{extend name="public/container"}
{block name="head_top"}
<link href="{__FRAME_PATH}css/plugins/iCheck/custom.css" rel="stylesheet">
<script src="{__PLUG_PATH}moment.js"></script>
<link rel="stylesheet" href="{__PLUG_PATH}daterangepicker/daterangepicker.css">
<script src="{__PLUG_PATH}daterangepicker/daterangepicker.js"></script>
<script src="{__ADMIN_PATH}frame/js/plugins/iCheck/icheck.min.js"></script>
<link href="{__FRAME_PATH}css/plugins/footable/footable.core.css" rel="stylesheet">
<script src="{__PLUG_PATH}sweetalert2/sweetalert2.all.min.js"></script>
<script src="{__FRAME_PATH}js/plugins/footable/footable.all.min.js"></script>
{/block}
{block name="content"}
<div class="row">
    <div class="col-sm-12">
        <div class="ibox">
            <div class="ibox-content">
                <div class="row">
                    <div class="m-b m-l">
                        <form class="form-inline">
                            <div class="input-group">
                                  <span class="input-group-btn">
                                      <input type="text" name="phone" id="phone" placeholder="手机号" class="input-sm form-control" size="38">
                                    <span id="search" class="btn btn-sm btn-primary"> 搜索</span>
                                     </span>
                            </div>
                        </form>
                    </div>
                </div>
                <h5>用户信息</h5>
                <div class="table-responsive">
                    <table class="table table-striped  table-bordered">
                        <thead>
                        <tr>
                            <th class="text-center">用户ID</th>
                            <th class="text-center">昵称</th>
                            <th class="text-center">头像</th>
                            <th class="text-center">手机号</th>
                            <th class="text-center">注册时间</th>
                        </tr>
                        </thead>
                        <tbody class="">
                        <tr>
                            <td class="text-center" id="userid">
                                ---
                            </td>
                            <td class="text-center" id="username">
                                ---
                            </td>
                            <td class="text-center">
                                <img src="" id="userimg" alt="" style="height: 60px;width: 60px;">
                            </td>
                            <td class="text-center" id="userphone">
                                ---
                            </td>
                            <td class="text-center" id="regtime">
                                ---
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <h5>相关订单</h5>
                <hr>
                <form class="layui-form">

                    <div class="layui-form-item">
                        <div class="layui-inline">

                            <label class="layui-form-label">订单类型：</label>

                            <div class="layui-input-inline">

                                <select name="status" lay-verify="status">

                                    <option value="">全部</option>

                                    <option value="1">平台承运</option>

                                    <option value="0">非平台承运</option>
                                    <option value="0">我要找车</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </form>
                <div class="table-responsive">
                    <table class="table table-striped  table-bordered">
                        <thead>
                        <tr>
                            <th class="text-center">编号</th>
                            <th class="text-center">订单类型</th>
                            <th class="text-center">订单ID</th>
                            <th class="text-center">用户ID</th>
                            <th class="text-center">手机号</th>
                            <th class="text-center">总价(元)</th>
                            <th class="text-center">商混站名称</th>
                            <th class="text-center">下单时间</th>
                            <th class="text-center">订单状态</th>
                            <th class="text-center">支付状态</th>
                            <th class="text-center">审核状态</th>
                            <th class="text-center" width="5%">操作</th>
                        </tr>
                        </thead>
                        <tbody class="" id="table-body">
                        </tbody>
                    </table>
                </div>

            </div>
        </div>
    </div>
</div>
<script src="{__ADMIN_PATH}js/layuiList.js"></script>

<script src="{__FRAME_PATH}js/content.min.js?v=1.0.0"></script>
{/block}
{block name="script"}
<script>
    $('#search').click(function () {
        var phone = $('#phone').val();
        var reg = /^1(3|4|5|6|7|8|9)\d{9}$/;
        var url = "{:Url('get_user_info')}";
        if(!(reg.test(phone))){
            return $eb.$swal('error','请输入正确的手机号查询！');
        }
        $.ajax({
            url:url,

            data:'phone='+phone,

            type:'post',

            dataType:'json',

            success:function (res) {
                if(res.code == 200) {
                    $eb.$swal('success',res.msg);
                    $('#userid').html(res.data.account);
                    $('#username').html(res.data.nickname);
                    $('#userimg').attr('src','http://www.shiliaobang.cn/'+res.data.avatar);
                    $('#userphone').html(res.data.phone);
                    $('#regtime').html(res.data.addtime);
                    var userid = res.data.account;
                    var  url =  "{:Url('get_orders')}";
                    $.ajax({
                        url:url,

                        data:'userid='+userid,

                        type:'post',

                        dataType:'json',

                        success:function (res) {
                            if(res.code == 200) {
                                var data = res.data;
                                console.log(data);
                                var html = '';
                                for (var i=0;i<data.length;i++){
                                    html +='<tr>\n' +
                                        '                            <td class="text-center">\n' +
                                        '                                '+data[i].orderno+'\n' +
                                        '                            </td>\n' +
                                        '                            <td class="text-center">\n' +
                                        '                                '+data[i].order_type+'' +
                                        '                            </td>\n' +
                                        '                            <td class="text-center">\n' +
                                        '                                '+data[i].orderno+'\n' +
                                        '                            </td>\n' +
                                        '                            <td class="text-center">\n' +
                                        '                                '+data[i].userid+'\n' +
                                        '                            </td>\n' +
                                        '                            <td class="text-center">\n' +
                                        '                                '+data[i].phone+'\n' +
                                        '                            </td>\n' +
                                        '                            <td class="text-center">\n' +
                                        '                                ￥'+data[i].totalprice+'\n' +
                                        '                            </td>\n' +
                                        '                            <td class="text-center">\n' +
                                        '                                '+data[i].bmixname+'\n' +
                                        '                            </td>\n' +
                                        '                            <td class="text-center">\n' +
                                        '                                '+data[i].ordertime+'\n' +
                                        '                            </td>\n' +
                                        '                            <td class="text-center">\n' +
                                        '                               '+data[i].statusd+'\n' +
                                        '                            </td>\n' +
                                        '                            <td class="text-center">\n' +
                                        '                               '+data[i].coststatus+'\n' +
                                        '                            </td>\n' +
                                        '                            <td class="text-center">\n';
                                    if(data[i].status == 5){
                                        html +='通过<br/>';
                                    }else if(data[i].status == 0){
                                        html +='未通过<br/>';
                                    }else{
                                        html +='<button data-url="{:url('cfail',['id'=>'+data[i].id+'])}" class="j-fail btn btn-danger btn-xs" type="button"><i class="fa fa-close"></i> 无效</button><button data-url="{:url('csucc',['id'=>'+data[i].id+'])}" class="j-success btn btn-primary btn-xs" type="button"><i class="fa fa-check"></i> 通过</button>';
                                    }
                                    html +='</td>\n' +
                                        '                            <td class="text-center">\n' +
                                        '                            </td>';
                                }
                                $('#table-body').html(html);
                            }
                        }

                    })
                }else{
                    $eb.$swal('error','暂无查询结果');
                }
            }

        })

    });
    layList.form.render();
</script>
{/block}
