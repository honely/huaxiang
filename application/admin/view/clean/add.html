{include file="index/header" /}
<style>
    .one-pan{
        position: relative;
    }
    .one{
        position: absolute;
        left:300px;
        top:0;
    }
</style>
<div class="layui-body">
    <div style="margin: 20px;">
    <span class="layui-breadcrumb" lay-separator=">">
        <a>清洁检查</a>
        <a><cite>创建订单</cite></a>
    </span>
    </div>
    <div style="margin: 10px">
        <div style="padding: 15px;">
            <form class="layui-form" action="<?=url('clean/add')?>" method="post">
                <div class="layui-form-item">
                    <label class="layui-form-label"><span style="color: red;">*</span>订单编号</label>
                    <div class="layui-input-block">
                        <input type="text" name="cc_order_id" lay-verify="required|title" placeholder="请输入订单编号" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label"><span style="color: red;">*</span>客户编号</label>
                    <div class="layui-input-block">
                        <input type="text" name="cc_user_name" lay-verify="required|title" placeholder="请输入客户编号" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item" pane>
                    <label class="layui-form-label"><span style="color: red;">*</span>收款时间</label>
                    <div class="layui-input-inline">
                        <input type="text" class="layui-input" lay-verify="required"  name="cc_pay_time" readonly id="alert" placeholder="请选择截止时间">
                    </div>
                    <div class="layui-form-mid layui-word-aux" style="color:red !important;">截止时间为澳洲时间。</div>
                </div>
                <div class="layui-form-item" pane>
                    <label class="layui-form-label">付款方式</label>
                    <div class="layui-input-inline">
                        <select name="cc_pay_type" lay-filter="cc_pay_type">
                            <option value="">请选择客户付款方式</option>
                            <option value="1">淘宝</option>
                            <option value="2">转账</option>
                            <option value="3">汇款</option>
                        </select>
                    </div>
                    <div class="layui-form-mid layui-word-aux" style="color:red !important;">客户付给我们的钱的付款方式</div>
                </div>
                <div class="layui-form-item" pane  id="order_price">
                    <label class="layui-form-label"><span style="color: red;">*</span>押金金额</label>
                    <div class="layui-input-inline">
                        <input type="number" class="layui-input" lay-verify="required" id="cc_price" name="cc_price" placeholder="$">
                    </div>
                    <div class="layui-form-mid layui-word-aux" id="price_unit" style="color:red !important;">单位：澳币（$）</div>
                </div>
                <div class="layui-form-item" pane>
                    <label class="layui-form-label"><span style="color: red;">*</span>租期</label>
                    <div class="layui-input-inline">
                        <select name="cc_rent_term" lay-verify="required">
                            <option value="">请选择租期</option>
                            <option value="6">6个月</option>
                            <option value="12">12个月</option>
                            <option value="18">18个月</option>
                            <option value="24">24个月</option>
                        </select>
                    </div>
                </div>
                <div class="layui-form-item" pane>
                    <label class="layui-form-label">付款ID</label>
                    <div class="layui-input-inline">
                        <input type="text" class="layui-input" name="cc_pay_id" placeholder="请输入付款ID，如淘宝订单号">
                    </div>
                </div>
                <div class="layui-form-item one-pan">
                    <label class="layui-form-label">收款凭证</label>
                    <div class="layui-upload-drag" id="uploadLogo" style="display:inline-block;">
                        <image id="logoPre">
                            <input type="hidden" name="cc_receipt" id="cc_receipt" value=""/>
                        </image>
                        <div id="display">
                            <i class="layui-icon"></i>
                            <p>请点击此处上传图片</p>
                        </div>
                    </div>
                </div>
                <div class="layui-form-item" pane>
                    <label class="layui-form-label">是否银行核对</label>
                    <div class="layui-input-block">
                        <input type="radio" name="cc_check" value="1" title="是">
                        <input type="radio" name="cc_check" value="2" title="否" checked>
                    </div>
                </div>
                <div class="layui-form-item" pane>
                    <label class="layui-form-label"><span style="color: red;">*</span>房型</label>
                    <div class="layui-input-inline">
                        <input type="text" class="layui-input" lay-verify="required"  name="cc_house_type" placeholder="请填写房型">
                    </div>
                </div>
                <div class="layui-form-item" pane>
                    <label class="layui-form-label"><span style="color: red;">*</span>户型</label>
                    <div class="layui-input-inline">
                        <input type="text" class="layui-input" lay-verify="required"  name="cc_room_type" placeholder="请填写户型">
                    </div>
                </div>
                <div class="layui-form-item" pane>
                    <label class="layui-form-label"><span style="color: red;">*</span>退款金额</label>
                    <div class="layui-input-inline">
                        <input type="number" class="layui-input" lay-verify="required"  name="cc_refund" placeholder="$">
                    </div>
                    <div class="layui-form-mid layui-word-aux" style="color:red !important;">每次通过清洁检查后退给客户的钱。</div>
                </div>
                <div class="layui-form-item layui-form-text">
                    <label class="layui-form-label">任务备注</label>
                    <div class="layui-input-block">
                        <textarea placeholder="请输入任务备注" name="cc_remarks" class="layui-textarea"></textarea>
                    </div>
                </div>
                <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                    <legend>清洁检查信息</legend>
                </fieldset>
                <div class="layui-form-item">
                    <table class="layui-table">
                        <colgroup>
                            <col width="150">
                            <col width="200">
                            <col width="200">
                            <col width="200">
                        </colgroup>
                        <thead>
                        <tr>
                            <th>检查时间</th>
                            <th>是否通过检查</th>
                            <th>退款凭证</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody  id="table">
                        </tbody>
                    </table>
                </div>
                <button type="button" id='addbtn' class="layui-btn layui-btn-sm layui-btn-normal">添加一次检查</button>
                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <button class="layui-btn" lay-submit lay-filter="saveInfo">创建</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<script>
    layui.use(['form', 'jquery','upload','laydate'], function(){
        var form = layui.form
            ,upload = layui.upload
            ,laydate = layui.laydate
            ,$ = layui.jquery;
        //alert
        laydate.render({
            elem: '#alert'
            ,type: 'date'
            ,trigger: 'click'
        });
        form.on('select(cc_pay_type)', function(data){
            var type = data.value;
            if(type == 1){
                $('#cc_price').attr('placeholder','￥');
                $('#cc_price').val('');
                $('#price_unit').html('单位：人民币（￥）');
            }else{
                $('#cc_price').attr('placeholder','$');
                $('#cc_price').val('');
                $('#price_unit').html('单位：澳币（$）');
            }
        });
        //图片上传
        upload.render({
            elem: '#uploadLogo'
            ,url: '{:url("clean/upload")}'
            ,size:600 //限制文件大小，单位 KB
            ,ext: 'jpg|png|gif'
            ,accept: 'images' //限制文件大小，单位 KB
            ,before: function(input){
                loading = layer.load(2, {
                    shade: [0.2,'#000']
                });
            }
            ,done: function(res){
                $('#logoPre').removeAttr('src');
                $('#cc_receipt').val('');
                console.log(res);
                console.log(res.filepath);
                layer.close(loading);
                $('#cc_receipt').val(res.filepath);
                $('#uploadLogo').removeClass('layui-upload-drag');
                $('#logoPre').css('width','216px');
                $('#logoPre').css('height','150px');
                $('#logoPre').attr('src',"__PUBLIC__/"+res.filepath);
                $('#display').hide();
                layer.msg(res.msg, {icon: 1, time: 1000});
            }
            ,error: function(res){
                layer.msg(res.msg, {icon: 2, time: 1000});
            }
        });
        form.verify({
            title: function(value){
                if(value.length < 2){
                    return '至少得2个字符啊';
                }
            }
            ,imgReg:function (value) {
                if(value.length <= 0){
                    return '请上传图片';
                }
            }
            ,content: function(value){
                var cont=layedit.getContent(index); //获取编辑器内容
                if(cont.length <= 0){
                    return '请输入内容信息！';
                }
            }
        });
    });
    function del(obj){
        $(obj).parents('.table-tr').remove();

    }

    $('#addbtn').click(function () {
        var html = "<tr class=\"table-tr\">\n" +
            "                            <td>\n" +
            "                                <input type=\"date\" name='cl_date[]' value=\"\" class=\"layui-input\">\n" +
            "                            </td>\n" +
            "                            <td>\n" +
            "                                否\n" +
            "                            </td>\n" +
            "                            <td>\n" +
            "                                <img style=\"width: 30px;height: 30px;\" src=\"__WEIUI__/images/pic_160.png\"/>\n" +
            "                            </td>\n" +
            "                            <td>\n" +
            "                                <span class=\"layui-btn layui-btn-danger layui-btn-xs\" onclick='del(this)'>删除</span>" +
            "                            </td>\n" +
            "                        </tr>";
       $('#table').append(html);
    });
</script>
{include file="index/footer" /}